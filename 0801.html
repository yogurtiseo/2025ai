<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riot API 프로젝트</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .wrap {
            width: 1000px;
            margin: 0 auto;
        }

        /* 헤더 검색 부분*/
        header {
            padding: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .search {
            width: 350px;
            height: 50px;
            margin-right: 25px;
            border-radius: 25px;
            border: 3px solid rgb(255, 28, 142);
        }

        .button {
            width: 100px;
            height: 50px;
            border-radius: 15px;
            background-color: rgb(255, 28, 142);
            color: #FFF;
            font-size: 15pt;
            font-weight: 900;
            border: none;
            cursor: pointer;
        }

        /*프로필 전적 요약 부분*/
        .profile {
            background-color: #EEE;
            padding: 20px;
        }

        .name {
            display: flex;
            border-bottom: 5px solid #FFF;
        }

        .name-left {
            position: relative;
        }

        .name-left .profile-img {
            width: 150px;
        }

        .name-left .profile-level {
            position: absolute;
            bottom: -5px;
            left: 65px;
            background-color: rgb(255, 28, 142);
            color: #FFF;
            border-radius: 5px;
            padding: 5px;
        }

        .name-right .tier {
            width: 100px;
        }

        /*20개 게임 승률, kda 구분 */
        .information {
            display: flex;
            justify-content: space-between;
        }

        .information .left .death {
            color: #F00;
        }

        .information .left .kda {
            font-size: 20pt;
            font-weight: 900;
        }

        .information .center img {
            width: 50px;
        }

        /* 20개 각각 게임들 */
        .games .win {
            background-color: rgb(211, 224, 244);
            border-left: 5px solid blue;
        }

        .games .lose {
            background-color: rgb(242, 186, 181);
            border-left: 5px solid blue;
        }

        .game {
            padding: 10px;
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .game-left {
            text-align: center;
        }

        .game .center .champion {
            width: 70px;
            border-radius: 10px;
        }

        .game .center .level {
            background-color: #F00;
            color: #FFF;
            border-radius: 10px;
            padding: 5px;
        }

        .game .center .rune1 {
            width: 50px;
        }

        .game .center .rune2 {
            width: 50px;
        }

        .game .center .spell1 {
            width: 50px;
        }

        .game .center .spell2 {
            width: 50px;
        }

        .game .center .items img {
            width: 30px;
        }

        .game .center .multikill {
            background-color: #F00;
            color: #FFF;
            border-radius: 10px;
            padding: 5px;
        }

        .game .center2 {
            text-align: center;
        }

        .game .center2 .kda {
            font-size: 17pt;
            font-weight: 900;
        }

        .game .center2 .kda .death {
            font-size: 17pt;
            font-weight: 900;
            color: #F00;
        }

        .game .center2 .rate {
            color: #999;
        }

        .game .center2 .cs {
            color: #999;
        }

        .game .right {
            display: flex;
            font-size: 8pt;
        }

        .game .right img {
            width: 20px;
        }

        .sp {
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <!--검색바-->
        <header>
            <input type="text" class="search" value="왕사마귀 #사마귀">
            <button class="button">검색</button>
        </header>

        <!--전적 요약 부분-->
        <div class="profile">
            <!--프로필요약-->
            <div class="name">
                <div class="name-left">
                    <img src="https://i1.sndcdn.com/artworks-dU4liUxICgrTtUXH-NRoWug-t500x500.jpg" alt="카리나"
                        class="profile-img">
                    <span class="profile-level">300</span>
                </div>
                <div class="name-right">
                    <h1>
                        장래희망개구리 #밍구리
                    </h1>
                    <div>
                        <img src="https://i.namu.wiki/i/ELjMIbhPY8bTdcaXD3XT0kHiknPMfqvATOl7zPMCESU6H4Nsit3iaKnuYpycdvq46utrS5kxpVTg383gJmWY3Q.webp"
                            alt="티어" class="tier">
                        <br>
                        승률<span class="rate">100%</span> /
                        <span class="win">100</span>승
                        <span class="lose">0</span>패
                    </div>
                </div>
            </div>
            <!--20개 게임 요약한 부분-->
            <div class="information">
                <div class="left">
                    승률 <span class="rate">100</span>% <span class="win">20</span>승 <span class="lose">0</span>패
                    <br>
                    <span class="kill">10</span> / <span class="death">4</span> / <span class="assist">10</span>
                    <br>
                    <span class="kda">5</span> : 1
                </div>
                <div class="center">
                    <h2>최근챔피언</h2>
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQSRm7cKO8CQbtshVW_BBHtdvo7tOoPrVDke08IRgckFlB48PIcNZRPt2TrzqEGrMWXheg&usqp=CAU"
                        alt="" class="cham1">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQSRm7cKO8CQbtshVW_BBHtdvo7tOoPrVDke08IRgckFlB48PIcNZRPt2TrzqEGrMWXheg&usqp=CAU"
                        alt="" class="cham2">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQSRm7cKO8CQbtshVW_BBHtdvo7tOoPrVDke08IRgckFlB48PIcNZRPt2TrzqEGrMWXheg&usqp=CAU"
                        alt="" class="cham3">
                </div>
                <div class="right">
                    탑<span class="top">4</span>
                    정글<span class="jungle">4</span>
                    미들<span class="middle">4</span>
                    바텀<span class="bottom">4</span>
                    서폿<span class="supporter">4</span>
                </div>
            </div>
        </div>

        <!--20개 게임들-->
        <div class="games">

        </div>


        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            const API_KEY = "RGAPI-00d48ba7-ca9a-49fc-b5d9-1a185af44576"
            let puuid

            const 검색창 = document.querySelector(".search")

            // 검색버튼 누르면 실행 시작
            const 검색버튼 = document.querySelector(".button")
            검색버튼.addEventListener("click", async function () {
                // 1. ACCOUNT-V1에서 puuid 불러오기 + input에 입력한 내가 원하는 유저의 puuid

                let id = 검색창.value.split("#")[0]
                let tag = 검색창.value.split("#")[1]
                await axios.get(`https://asia.api.riotgames.com/riot/account/v1/accounts/by-riot-id/${id}/${tag}?api_key=${API_KEY}`)
                    .then(function (response) {
                        puuid = response.data.puuid
                        console.log(response);
                        console.log(puuid);
                        const 이름지정 = document.querySelector(".name-right h1")
                        이름지정.textContent = response.data.gameName + "#" + response.data.tagLine
                    })
                    .catch(function (error) {
                        console.log("에러남");
                    })
                // 2. SUMMONER-V4에서 소환사 정보 불러오기 (레벨, 프사)
                await axios.get(`https://kr.api.riotgames.com/lol/summoner/v4/summoners/by-puuid/${puuid}?api_key=${API_KEY}`)
                    .then(function (response) {
                        console.log(response);
                        let 소환사레벨 = response.data.summonerLevel
                        let 프사번호 = response.data.profileIconId
                        console.log(소환사레벨)
                        console.log(프사번호)
                        const 레벨지정 = document.querySelector(".profile-level")
                        레벨지정.textContent = 소환사레벨
                        const 프사지정 = document.querySelector(".profile-img")
                        프사지정.setAttribute("src", `https://opgg-static.akamaized.net/meta/images/profile_icons/profileIcon${프사번호}.jpg`)
                    })
                    .catch(function (error) {
                        console.log("에러남");
                    })

                // 3. LEAGUE-V4에서 랭겜 정보 불러오기(랭크, 승, 패)
                await axios.get(`https://kr.api.riotgames.com/lol/league/v4/entries/by-puuid/${puuid}?api_key=${API_KEY}`)
                    .then(function (response) {
                        console.log(response);
                        // 랭크 이미지 변경
                        const 랭크이미지 = document.querySelector(".tier")
                        랭크이미지.src = `https://opgg-static.akamaized.net/images/medals_new/${response.data[0].tier.toLowerCase()}.png`
                        // 승률, 승, 패, 계산
                        const 승 = document.querySelector(".win")
                        const 패 = document.querySelector(".lose")
                        const 승률 = document.querySelector(".rate")
                        승.textContent = response.data[0].wins
                        패.textContent = response.data[0].losses
                        승률.textContent = (response.data[0].wins / (response.data[0].wins + response.data[0].losses)).toFixed(2) * 100 + "%"
                    })
                    .catch(function (error) {
                        console.log("에러남");
                    })

                게임20개()
            })

            async function 게임20개() {
                // 4-1 MATCH-V5에서 게임 20개 정보 불러오기
                await axios.get(`https://asia.api.riotgames.com/lol/match/v5/matches/by-puuid/${puuid}/ids?start=0&count=20&api_key=${API_KEY}`)
                    .then(async function (response) {
                        let 게임들 = response.data

                        for (let i = 0; i < 20; i = i + 1) {
                            await 게임분석(게임들[i])
                        }
                    })
                    .catch(function (error) {
                        console.log("에러남");
                    })
            }
            // 4-2 매치 정보 불러오기
            async function 게임분석(게임id) {
                console.log(게임id, "분석")
                await axios.get(`https://asia.api.riotgames.com/lol/match/v5/matches/${게임id}?api_key=${API_KEY}`)
                    .then(function (response) {
                        console.log(response)

                        let 내번호
                        for (let i = 0; i < 10; i = i + 1) {
                            if (response.data.info.participants[i].puuid == puuid) {
                                내번호 = i
                                console.log(내번호)
                            }
                        }

                        const 부모 = document.querySelector('.games')

                        let 게임 = document.createElement("div")
                        게임.classList.add("game")

                        let 승리여부
                        if (response.data.info.participants[내번호].win) {
                            게임.classList.add("win") // 이기면 win
                            승리여부 = "승리"
                        }
                        else {
                            게임.classList.add("lose") // 지면 lose
                            승리여부 = "패배"
                        }

                        게임.innerHTML = `
                    <div class="left">
                        <p class="queue">${response.data.info.gameMode}</p>
                        <p class="sp">${승리여부}</p>
                    </div>
                    <div class="center">
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[내번호].championName}.png"alt="" class="champion">
                        <span class="level">level ${response.data.info.participants[내번호].champLevel}</span>
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/perk/${response.data.info.participants[내번호].perks.styles[0].selections[0].perk}.png"alt="" class="rune1">
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/perkStyle/${response.data.info.participants[내번호].perks.styles[1].style}.png" class="rune2">
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/spell/SummonerFlash.png"alt="" class="spell1">
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/spell/SummonerFlash.png"alt="" class="spell2">
                        <span class="multikill">${"펜타킬"}</span>

                        <div class="items">
                        <img src=" https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item0}.png" class="item1">
                        <img src=" https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item1}.png" class="item2">
                        <img src=" https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item2}.png" class="item3">
                        <img src=" https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item3}.png" class="item4">
                        <img src=" https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item4}.png" class="item5">
                        <img src=" https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item5}.png" class="item6">
                    </div>
                </div>
                <div class="center2">
                    <p class="kda"><span class="kill">${response.data.info.participants[내번호].kills}</span> / <span class="death">${response.data.info.participants[내번호].deaths}</span> / <span class="assist">${response.data.info.participants[내번호].assists}</span></p>
                    <p class="rate">평점<span>${response.data.info.participants[내번호].kills + response.data.info.participants[내번호].assists / response.data.info.participants[내번호].deaths}</span></p>
                    <p class="cs"><span class="cs">${response.data.info.participants[내번호].totalMinionsKilled}</span> CS</p>
                </div>
                <div class="right">
                    <div class="team1">
                        <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[0].championName}.png"><span>${response.data.info.participants[0].riotIdGameName}</span></p>
                        <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[1].championName}.png"><span>${response.data.info.participants[1].riotIdGameName}</span></p>
                        <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[2].championName}.png"><span>${response.data.info.participants[2].riotIdGameName}</span></p>
                        <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[3].championName}.png"><span>${response.data.info.participants[3].riotIdGameName}</span></p>
                        <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[4].championName}.png"><span>${response.data.info.participants[4].riotIdGameName}</span></p>
                    </div>
                    <div class="team2">
                        <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[5].championName}.png"><span>${response.data.info.participants[5].riotIdGameName}</span></p>
                        <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[6].championName}.png"><span>${response.data.info.participants[6].riotIdGameName}</span></p>
                        <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[7].championName}.png"><span>${response.data.info.participants[7].riotIdGameName}</span></p>
                        <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[8].championName}.png"><span>${response.data.info.participants[8].riotIdGameName}</span></p>
                        <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[9].championName}.png"><span>${response.data.info.participants[9].riotIdGameName}</span></p>
                    </div>
                </div> `
                        부모.appendChild(게임)

                    })
                    .catch(function (error) {
                        console.log("에러남");
                    })
                console.log(게임id, "분석완료")
            }

        </script>


</body>

</html>